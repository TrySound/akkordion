/*!
 * akkordion 0.2.1
 * Accordion UI Element
 * https://github.com/TrySound/akkordion
 * 
 * Released under the MIT license
 * Copyright (c) 2015, Bogdan Chadkin <trysound@yandex.ru>
 */
!function(e){window.akkordion=e(window,document)}(function(e,t,n){function o(e,t){var n=this;n.root=e,n.options=f({},t,c(e)),n.cache(),n.setDefaultState(),n.bindEvents(),u("init",n)}function r(e,n){var r,n=f({},h,n);for("string"==typeof e&&(e=t.querySelectorAll(e)),i=0,max=e.length;i<max;i++)r=e[i],a(r,y)||(a(r,y,!0),S.push(new o(r,n)))}function u(e,t,n){var o,i,r=d[e],u=t.root,s=t.titleSet[n],a=t.contentSet[n],l=!0;for(o=0,i=r.length;i>o;o++)l=r[o].call(u,s,a)===!1?!1:l;return l}function s(e,t,n){n=n?!0:null,a(e.titleSet[t],b,n),a(e.outerSet[t],b,n),a(e.contentSet[t],b,n)}function a(e,t,o){return t="data-"+p+"-"+t,o===n?e.hasAttribute(t):null===o?e.removeAttribute(t):e.setAttribute(t,o)}function l(e,t,n){e.addEventListener(t,n,!1)}function f(){var e,t,o,i,r=arguments[0]||{};for(e=1,t=arguments.length;t>e;e++)if(o=arguments[e],null!=o)for(i in o)o.hasOwnProperty(i)&&o[i]!==n&&(r[i]=o[i]);return r}function c(e){var t,n,o,i=e.attributes,r="data-"+p+"-",u={};for(t=i.length;t--;)n=i[t].name,o=i[t].value,0===n.indexOf(r)&&(u[n.substring(r.length)]="true"===o?!0:"false"===o?!1:isNaN(o)?o:Number(o));return u}var h={single:!0,speed:300,hover:!1},d={init:[],abort:[],beforeopen:[],open:[],afteropen:[],beforeclose:[],close:[],afterclose:[]},p="akkordion",g=!1,v=!1,b="active",m="animating",y="initialized";!function(){var e=t.createElement("div");e.style.WebkitTransition!==n&&(g="-webkit-transition",v="webkitTransitionEnd"),e.style.transition!==n&&(g="transition",v="transitionend")}(),o.prototype={cache:function(){var e,n,o,i,r=this,u=r.root,s=u.querySelectorAll("."+p+"-title"),a=t.createElement("div"),l=[],f=[],c=[];for(a.className=p+"-outer",e=s.length-1;e>-1;e--)(n=s[e]).parentNode===u&&(o=(o=n.nextSibling)?1===o.nodeType?o:(o=o.nextSibling)&&1===o.nodeType?o:null:null,o=o&&o.className.indexOf(p+"-content")>-1?o:null,o&&(l.unshift(n),i=a.cloneNode(),i.appendChild(u.replaceChild(i,o)),c.unshift(i),f.unshift(o)));r.titleSet=l,r.outerSet=c,r.contentSet=f},setDefaultState:function(){var e,t=this,n=t.outerSet,o=t.contentSet;for(e=n.length-1;e>-1;e--)o[e].style.height="auto",o[e].className.indexOf(p+"-active")>-1&&(s(t,e,!0),n[e].style.height="auto")},bindEvents:function(){function e(e){for(var t,i=n.titleSet,r=e.target,u=r;o!==u&&!((t=i.indexOf(u))>-1);)u=u.parentNode;t>-1&&(a(u,b)?n.close(t):n.open(t),e.preventDefault())}var t,n=this,o=n.root;l(o,"mouseover",function(o){var i=n.options.hover;i!==!1&&(t=setTimeout(function(){e(o)},i))}),l(o,"mouseout",function(){clearTimeout(t)}),l(o,"click",e),l(o,v,function(e){var t,o=e.target;"height"===e.propertyName&&(t=n.outerSet.indexOf(o))>-1&&(a(o,m,null),a(o,b)?(o.style.cssText="height:auto;",u("afteropen",n,t)):(o.style.cssText="",u("afterclose",n,t)))})},open:function(e,t){var n,o,i,r=this,l=r.outerSet,f=r.options,c=f.speed;if(e=-1===e?l.length-1:e,i=l[e],!i)return!1;if(f.single)for(o=l.length-1;o>-1;o--)o!==e&&r.close(o,t);if(!g||t||0===c){if(!u("beforeopen",r,e))return void u("abort",r,e);s(r,e,!0),i.style.cssText="height:auto;",u("open",r,e),u("afteropen",r,e)}else if(!a(i,m)&&!a(i,b)){if(!u("beforeopen",r,e))return void u("abort",r,e);s(r,e,!0),a(i,m,!0),i.style.height="auto",n=getComputedStyle(i).height,i.style.height=0,i.offsetWidth,i.style.cssText="height:"+n+";"+g+"-duration:"+c+"ms;",u("open",r,e)}},close:function(e,t){var n=this,o=n.outerSet,i=n.options.speed;if(e=-1===e?o.length-1:e,outer=o[e],!outer)return!1;if(!g||t||0===i){if(!u("beforeclose",n,e))return void u("abort",n,e);s(n,e,!1),outer.style.cssText="",u("close",n,e),u("afterclose",n,e)}else if(!a(outer,m)&&a(outer,b)){if(!u("beforeclose",n,e))return void u("abort",n,e);s(n,e,!1),a(outer,m,!0),outer.style.height=getComputedStyle(outer).height,outer.offsetHeight,outer.style.cssText=g+"-duration:"+i+"ms;",u("close",n,e)}}};var S=[];return r.on=function(e,t){var n=d[e=e.toLowerCase()];return n&&"function"==typeof t&&n.push(t),r},r.open=function(e,t,n){if(e)for(i=S.length-1;i>-1;i--)if(S[i].root===e)return S[i].open(Number(t),n)!==!1},r.close=function(e,t,n){if(e)for(i=S.length-1;i>-1;i--)if(S[i].root===e)return S[i].close(Number(t),n)!==!1},l(t,"DOMContentLoaded",function(){r("."+p)}),r});
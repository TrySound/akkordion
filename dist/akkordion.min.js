/*!
 * akkordion 0.1.1
 * Accordion UI Element
 * https://github.com/TrySound/akkordion
 * 
 * Released under the MIT license
 * Copyright (c) 2015, Bogdan Chadkin <trysound@yandex.ru>
 */
!function(t){window.akkordion=t(window,document)}(function(t,e,n){function o(t,e){this.root=t,this.options=u({},e,f(t,v)),this.cache(),this.setDefaultState(),this.bindEvents(),r("init",this)}function s(t,n){var s,n=u({},c,n);for("string"==typeof t&&(t=e.querySelectorAll(t)),i=0,max=t.length;i<max;i++)s=t[i],a(s,m)||(a(s,m,!0),new o(s,n))}function r(t,e,i){var n,o,s=d[t],r=e.root,l=e.titleSet[i],a=e.contentSet[i],h=!0;for(n=0,o=s.length;o>n;n++)h=s[n].call(r,l,a)===!1?!1:h;return h}function l(t,e,i){i=i?!0:null,a(t.titleSet[e],b,i),a(t.outerSet[e],b,i),a(t.contentSet[e],b,i)}function a(t,e,i){return i===n?t.hasAttribute(e):null===i?t.removeAttribute(e):t.setAttribute(e,i)}function h(t,e,i){t.addEventListener(e,i,!1)}function u(){var t,e,i,n,o=arguments[0]||{};for(t=1,e=arguments.length;e>t;t++)if(i=arguments[t],null!=i)for(n in i)i.hasOwnProperty(n)&&"undefined"!=typeof i[n]&&(o[n]=i[n]);return o}function f(t,e){var i,n,o,s=t.attributes,r=e.length,l={};for(i=s.length;i--;)n=s[i].name,o=s[i].value,n.indexOf(e)>-1&&(l[n.substring(r)]="true"===o?!0:"false"===o?!1:0/0!==Number(o)?Number(o):o);return l}var c={single:!0,speed:300,opacity:!1},d={init:[],abort:[],beforeopen:[],open:[],afteropen:[],beforeclose:[],close:[],afterclose:[]},p="akkordion",g=!1,y=!1,v="data-"+p+"-",b=v+"active",S=v+"animating",m=v+"initialized";return function(){var t=e.createElement("div");t.style.WebkitTransition!==n&&(g="-webkit-transition",y="webkitTransitionEnd"),t.style.transition!==n&&(g="transition",y="transitionend")}(),o.prototype={cache:function(){var t,i,n,o,s=this.root,r=s.querySelectorAll("."+p+"-title"),l=e.createElement("div"),a=[],h=[],u=[];for(l.className=p+"-outer",t=r.length-1;t>-1;t--)(i=r[t]).parentNode===s&&(n=(n=i.nextSibling)?1===n.nodeType?n:(n=n.nextSibling)&&1===n.nodeType?n:null:null,n=n&&n.className.indexOf(p+"-content")>-1?n:null,n&&(a.unshift(i),o=l.cloneNode(),o.appendChild(s.replaceChild(o,n)),u.unshift(o),h.unshift(n)));this.titleSet=a,this.outerSet=u,this.contentSet=h},setDefaultState:function(){var t,e,i,n,o=this.titleSet,s=this.outerSet,r=this.contentSet,l=this.options.single,h=!1;for(t=0,e=o.length;e>t;t++)i=s[t],(n=r[t]).style.height="auto",n.className.indexOf(p+"-active")>-1&&(l&&!h||!l)?(h=!0,a(o[t],b,!0),a(i,b,!0),a(n,b,!0)):i.style.height=0},bindEvents:function(){var t=this;h(this.root,"click",function(e){var i,n=e.target,o=t.titleSet.indexOf(n);if(n.className.indexOf(p+"-title")>-1&&e.preventDefault(),o>-1)if(a(n,b))t.close(o);else if(t.open(o),t.options.single)for(i=t.outerSet.length-1;i>-1;i--)i!==o&&t.close(i)}),h(this.root,y,function(e){var i,n=e.target,o=e.propertyName;"height"===o&&(i=t.outerSet.indexOf(n))>-1&&(a(n,S,null),a(n,b)?(n.style.cssText="height:auto;",r("open",t,i),r("afteropen",t,i)):(n.style.cssText="height:0;",r("close",t,i),r("afterclose",t,i)))})},open:function(t,e){var i,n=this.outerSet[t],o=this.contentSet[t],s=this.options,h=s.opacity?"height:auto;opacity:":!1,u=s.speed,f=g+"-duration:"+u+"ms;",c=g+"-delay:"+u/2+"ms;";if(!g||e||0===u){if(!r("beforeopen",this,t))return void r("abort",this,t);l(this,t,!0),n.style.cssText="height:auto;",r("open",this,t),r("afteropen",this,t)}else if(!a(n,S)&&!a(n,b)){if(!r("beforeopen",this,t))return void r("abort",this,t);l(this,t,!0),a(n,S,!0),n.style.height="auto",i=getComputedStyle(n).height,n.style.height=0,n.offsetWidth,n.style.cssText="height:"+i+";"+f,h&&(o.style.cssText=h+"0;",n.offsetWidth,o.style.cssText=h+"1;"+f+c)}},close:function(t,e){var i=this.outerSet[t],n=this.contentSet[t],o=this.options,s=o.opacity?"height:auto;opacity:":!1,h=o.speed,u=g+"-duration:"+h+"ms;",f=g+"-delay:"+h/3+"ms;";if(!g||e||0===h){if(!r("beforeclose",this,t))return void r("abort",this,t);l(this,t,!1),i.style.cssText="height:0;",r("close",this,t),r("afterclose",this,t)}else if(!a(i,S)&&a(i,b)){if(!r("beforeclose",this,t))return void r("abort",this,t);l(this,t,!1),a(i,S,!0),i.style.height=getComputedStyle(i).height,i.offsetHeight,i.style.cssText="height:0;"+u+(s?f:""),s&&(n.style.cssText=s+"1;",i.offsetWidth,n.style.cssText=s+"0;"+u)}}},s.on=function(t,e){var i=d[t=t.toLowerCase()];return i&&"number"==typeof i.length&&"function"==typeof e&&i.push(e),s},h(e,"DOMContentLoaded",function(){s(".akkordion")}),s});
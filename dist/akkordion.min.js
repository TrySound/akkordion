/*!
 * akkordion 0.0.2
 * Accordion UI Element
 * https://github.com/TrySound/akkordion
 * 
 * Released under the MIT license
 * Copyright (c) 2015, Bogdan Chadkin <trysound@yandex.ru>
 */
!function(t){window.akkordion=t(window,document)}(function(t,e,o){function n(t,e){this.root=t,this.options=h({},e,c(t,d)),this.cache(),this.setDefaultState(),this.bindEvents(),r("init",t)}function s(t,o){var s,o=h({},m,o);for("string"==typeof t&&(t=e.querySelectorAll(t)),i=0,max=t.length;i<max;i++)s=t[i],a(s,S)||(a(s,S,!0),new n(s,o))}function r(t,e,o,n){var s=b[t],r=!0;for(i=0,max=s.length;i<max;i++)r=s[i].call(e,o,n)===!1?!1:r;return r}function a(t,e,i){return i===o?t.hasAttribute(e):null===i?t.removeAttribute(e):t.setAttribute(e,i)}function l(t,e,i){t.addEventListener(e,i,!1)}function h(){var t,e,i,o,n=arguments[0]||{};for(t=1,e=arguments.length;e>t;t++)if(i=arguments[t],null!=i)for(o in i)i.hasOwnProperty(o)&&"undefined"!=typeof i[o]&&(n[o]=i[o]);return n}function c(t,e){var i,o,n,s=t.attributes,r=e.length,a={};for(i=s.length;i--;)o=s[i].name,n=s[i].value,o.indexOf(e)>-1&&(a[o.substring(r)]="true"===n?!0:"false"===n?!1:0/0!==Number(n)?Number(n):n);return a}var u=!1,f=!1,p=!1,d="data-akkordion-",g=d+"active",y=d+"animating",v=d+"index",S=d+"initialized";!function(){var t=e.createElement("div");t.style.WebkitTransform!==o&&(u="-webkit-transform"),t.style.transform!==o&&(u="transform"),t.style.WebkitTransition!==o&&(f="-webkit-transition",p="webkitTransitionEnd"),t.style.transition!==o&&(f="transition",p="transitionend")}();var m={single:!0,speed:300,opacity:!1},b={init:[],abort:[],beforeopen:[],open:[],afteropen:[],beforeclose:[],close:[],afterclose:[]};return n.prototype.cache=function(){var t,i,o,n,s=this.root,r=s.querySelectorAll(".akkordion-title"),a=e.createElement("div"),l=[],h=[],c=[];for(a.className="akkordion-outer",t=r.length-1;t>-1;t--)(i=r[t]).parentNode===this.root&&(o=(o=i.nextSibling)?1===o.nodeType?o:(o=o.nextSibling)&&1===o.nodeType?o:null:null,o=o&&o.className.indexOf("akkordion-content")>-1?o:null,o&&(l.unshift(i),n=a.cloneNode(),n.appendChild(s.replaceChild(n,o)),c.unshift(n),h.unshift(o)));this.titleSet=l,this.outerSet=c,this.contentSet=h},n.prototype.setDefaultState=function(){var t,e,i,o,n,s=this.titleSet,r=this.outerSet,l=this.contentSet,h=this.options.single;for(t=0,e=s.length;e>t;t++)a(i=s[t],v,t),a(o=r[t],v,t),(n=l[t]).style.height="auto",n.className.indexOf("akkordion-active")>-1&&(h&&!this.initSingle||!h)?(this.initSingle=!0,a(i,g,!0),a(o,g,!0),a(n,g,!0)):o.style.height=0},n.prototype.bindEvents=function(){var t=this;l(this.root,"click",function(t){t.target.className.indexOf("akkordion-title")>-1&&t.preventDefault()}),l(this.root,"click",function(e){var i,o=e.target,n=t.titleSet.indexOf(o);if(n>-1)if(a(o,g))t.close(n);else if(t.open(n),t.options.single)for(i=t.outerSet.length-1;i>-1;i--)i!==n&&t.close(i)}),l(this.root,p,function(e){var i,o,n,s=e.target,l=e.propertyName;"height"===l&&(i=t.outerSet.indexOf(s))>-1&&(o=t.titleSet[i],n=t.contentSet[i],a(s,y,null),a(s,g)?(s.style.cssText="height:auto;",r("open",this,o,n),r("afteropen",this,o,n)):(s.style.cssText="height:0;",r("close",this,o,n),r("afterclose",this,o,n)))})},n.prototype.setActive=function(t,e){e?(a(this.titleSet[t],g,!0),a(this.outerSet[t],g,!0),a(this.contentSet[t],g,!0)):(a(this.titleSet[t],g,null),a(this.outerSet[t],g,null),a(this.contentSet[t],g,null))},n.prototype.open=function(t,e){var i,o=this.root,n=this.titleSet[t],s=this.outerSet[t],l=this.contentSet[t],h=f+"-duration:"+this.options.speed+"ms;",c=f+"-delay:"+this.options.speed/2+"ms;",u=this.options.opacity;if(!f||e){if(!r("beforeopen",o,n,l))return void r("abort",o,n,l);this.setActive(t,!0),s.style.cssText="height:auto;",r("open",o,n,l),r("afteropen",o,n,l)}else if(!a(s,y)&&!a(s,g)){if(!r("beforeopen",o,n,l))return void r("abort",o,n,l);this.setActive(t,!0),a(s,y,!0),s.style.height="auto",i=getComputedStyle(s).height,s.style.height=0,s.offsetWidth,s.style.cssText="height:"+i+";"+h,u&&(l.style.cssText="height:auto;opacity:0;",s.offsetWidth,l.style.cssText="height:auto;opacity:1;"+h+c)}},n.prototype.close=function(t,e){var i=this.root,o=this.titleSet[t],n=this.outerSet[t],s=this.contentSet[t],l=f+"-duration:"+this.options.speed+"ms;",h=f+"-delay:"+this.options.speed/3+"ms;",c=this.options.opacity;if(!f||e){if(!r("beforeclose",i,o,s))return void r("abort",i,o,s);this.setActive(t,!1),n.style.cssText="height:0;",r("close",i,o,s),r("afterclose",i,o,s)}else if(!a(n,y)&&a(n,g)){if(!r("beforeclose",i,o,s))return void r("abort",i,o,s);this.setActive(t,!1),a(n,y,!0),n.style.height=getComputedStyle(n).height,n.offsetHeight,n.style.cssText="height:0;"+l+(c?h:""),c&&(s.style.cssText="height:auto;opacity:1;",n.offsetWidth,s.style.cssText="height:auto;opacity:0;"+l)}},s.on=function(t,e){var i=b[t=t.toLowerCase()];return i&&"number"==typeof i.length&&"function"==typeof e&&i.push(e),s},l(e,"DOMContentLoaded",function(){s(".akkordion")}),s});